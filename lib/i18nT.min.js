/*
i18nT
author: Bartlomiej Obecny obecny@interia.pl
translation module for angular
generated on:
2014-02-05 00:02 version: 0.0.1 
*/

angular.module("i18nT",["ng"]).run(["$i18nT",function(a){"use strict";if(!a.getLanguage())throw"i18nT: no language set, use setDefaultLanguage"}]),angular.module("i18nT").provider("$i18nT",[function(){"use strict";var a,b,c,d,e,f,g="",h={},i={},j={};a=function(b,c){var d={};return c=c?c+".":"",angular.forEach(b,function(b,e){angular.isString(b)||angular.isArray(b)?d[c+e]=b:angular.extend(d,a(b,c+e))}),d},b=function(){return g},c=function(a){var b;return b=angular.isArray(a)?a[0]:"defaults",angular.copy(h[g][b])},d=function(a){return j[g][a]},e=function(a){g=a},f=function(b,c,d){j[b]=a(c),h[b]=d},this.$get=["$rootScope",function(a){return i.getLanguage=b,i.getPlurals=c,i.getTranslations=d,i.setLanguage=function(b){e(b),a.$broadcast("i18nTLanguageChange")},i}],this.translations=f,this.setDefaultLanguage=e}]),angular.module("i18nT").filter("i18nT",["$i18nT",function($i18nT){"use strict";var cache={},cacheKey;return function(key,arr){var getTranslation,replacePluralRules,params,plurals,translation;return cacheKey=$i18nT.getLanguage()+"__"+key+"__"+JSON.stringify(arr||""),cache[cacheKey]?cache[cacheKey]:(getTranslation=function(pluralRules,translation,params){var i,length,re,rule;for(i=0,length=pluralRules.length;length>i;i++)if(eval(pluralRules[i])){rule=i+1;break}return rule>0&&(translation=translation[rule]),angular.forEach(params,function(a,b){re=new RegExp("\\$"+b,"g"),translation=translation.replace(re,a)}),translation},replacePluralRules=function(a,b){var c,d;return d=angular.copy(a),angular.forEach(a,function(a,e){angular.forEach(b,function(a,b){c=new RegExp("\\b"+b,"g"),d[e]=d[e].replace(c,angular.isNumber(a)?Math.abs(a):"'"+a+"'")})}),d},params=(arr||[])[0],translation=$i18nT.getTranslations(key),translation&&(plurals=replacePluralRules($i18nT.getPlurals(translation),params)),translation&&"string"!=typeof translation?translation=params?getTranslation(plurals,translation,params):"":params&&(translation=getTranslation([],translation,params)),cache[cacheKey]=translation,translation?translation||key:key)}}]),angular.module("i18nT").directive("i18nT".toLowerCase(),["$filter",function(a){"use strict";var b;return b=a("i18nT"),{restrict:"AE",scope:!0,link:function(a,c,d){d.$observe("i18nT".toLowerCase(),function(d){a.i18nKey||(a.i18nKey=d,c.html(b(d)))}),a.$on("i18nTLanguageChange",function(){c.html(b(a.i18nKey))})}}}]);